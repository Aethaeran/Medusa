{"version":3,"names":[],"mappings":"","sources":["js/home/display-show.js"],"sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\nconst MEDUSA = require('./core');\n\nconst startAjaxEpisodeSubtitles = function () {\n    const searchTypesList = ['.epSubtitlesSearch', '.epSubtitlesSearchPP', '.epRedownloadSubtitle', '.epSearch', '.epRetry', '.epManualSearch'];\n    const subtitlesResultModal = $('#manualSubtitleSearchModal');\n    const subtitlesMulti = MEDUSA.config.subtitlesMulti;\n    const loadingSpinner = 'images/loading32' + MEDUSA.config.themeSpinner + '.gif';\n    let subtitlesTd;\n    let selectedEpisode;\n\n    const disableAllSearches = () => {\n        // Disables all other searches while manual searching for subtitles\n        $.each(searchTypesList, (index, searchTypes) => {\n            $(searchTypes).css({\n                'pointer-events': 'none'\n            });\n        });\n    };\n\n    const enableAllSearches = () => {\n        // Enabled all other searches while manual searching for subtitles\n        $.each(searchTypesList, (index, searchTypes) => {\n            $(searchTypes).css({\n                'pointer-events': 'auto'\n            });\n        });\n    };\n\n    const changeImage = (imageTR, srcData, altData, titleData, heightData, emptyLink) => {\n        // eslint-disable-line max-params\n        if (emptyLink === true) {\n            imageTR.find('img').remove();\n        }\n        imageTR.append($('<img/>').prop({\n            src: srcData,\n            alt: altData,\n            title: titleData,\n            width: 16,\n            height: heightData\n        }));\n    };\n\n    subtitlesResultModal.on('hidden.bs.modal', () => {\n        // If user close manual subtitle search modal, enable again all searches\n        enableAllSearches();\n    });\n\n    $.ajaxEpSubtitlesSearch = function () {\n        const searchSubtitles = () => {\n            disableAllSearches();\n            changeImage(selectedEpisode, loadingSpinner, 'loading', 'loading', 16, true);\n            let url = selectedEpisode.prop('href');\n            // If manual search, replace handler\n            url = url.replace('searchEpisodeSubtitles', 'manual_search_subtitles');\n            $.getJSON(url, data => {\n                // Delete existing rows in the modal\n                const existingRows = $('#subtitle_results tr').length;\n                if (existingRows > 1) {\n                    for (let x = existingRows - 1; x > 0; x--) {\n                        $('#subtitle_results tr').eq(x).remove();\n                    }\n                }\n                // Add the release to the modal title\n                $('h4#manualSubtitleSearchModalTitle.modal-title').text(data.release);\n                if (data.result === 'success') {\n                    $.each(data.subtitles, (index, subtitle) => {\n                        // For each subtitle found create the row string and append to the modal\n                        const provider = '<img src=\"images/subtitles/' + subtitle.provider + '.png\" width=\"16\" height=\"16\" style=\"vertical-align:middle;\"/>';\n                        const flag = '<img src=\"images/subtitles/flags/' + subtitle.lang + '.png\" width=\"16\" height=\"11\"/>';\n                        let missingGuess = '';\n                        for (let i = 0; i < subtitle.missing_guess.length; i++) {\n                            let value = subtitle.missing_guess[i];\n                            if (missingGuess) {\n                                missingGuess += ', ';\n                            }\n                            value = value.charAt(0).toUpperCase() + value.slice(1);\n                            missingGuess += value.replace(/(_[a-z])/g, $1 => $1.toUpperCase().replace('_', ' '));\n                        }\n                        const subtitleName = subtitle.filename.substring(0, 99);\n                        let subtitleScore = subtitle.score;\n                        // If hash match, don't show missingGuess\n                        if (subtitle.sub_score >= subtitle.max_score) {\n                            missingGuess = '';\n                        }\n                        // If perfect match, add a checkmark next to subtitle filename\n                        let checkmark = '';\n                        if (subtitle.sub_score >= subtitle.min_score) {\n                            checkmark = '<img src=\"images/save.png\" width=\"16\" height=\"16\"/>';\n                        }\n                        const subtitleLink = '<a href=\"#\" id=\"pickSub\" title=\"Download subtitle: ' + subtitle.filename + '\" subtitleID=\"subtitleid-' + subtitle.id + '\">' + subtitleName + checkmark + '</a>';\n                        // Make subtitle score always between 0 and 10\n                        if (subtitleScore > 10) {\n                            subtitleScore = 10;\n                        } else if (subtitleScore < 0) {\n                            subtitleScore = 0;\n                        }\n                        const row = '<tr style=\"font-size: 95%;\">' + '<td style=\"white-space:nowrap;\">' + provider + ' ' + subtitle.provider + '</td>' + '<td>' + flag + '</td>' + '<td title=\"' + subtitle.sub_score + '/' + subtitle.min_score + '\"> ' + subtitleScore + '</td>' + '<td class=\"tvShow\"> ' + subtitleLink + '</td>' + '<td>' + missingGuess + '</td>' + '</tr>';\n                        $('#subtitle_results').append(row);\n                        // Allow the modal to be resizable\n                        $('.modal-content').resizable({\n                            alsoResize: '.modal-body'\n                        });\n                        // Allow the modal to be draggable\n                        $('.modal-dialog').draggable({\n                            cancel: '.text'\n                        });\n                        // After all rows are added, show the modal with results found\n                        subtitlesResultModal.modal('show');\n                    });\n                }\n                // Add back the CC icon as we are not searching anymore\n                changeImage(selectedEpisode, 'images/closed_captioning.png', 'Search subtitles', 'Search subtitles', 16, true);\n                enableAllSearches();\n            });\n            return false;\n        };\n\n        const forcedSearch = () => {\n            disableAllSearches();\n            changeImage(selectedEpisode, loadingSpinner, 'loading', 'loading', 16, true);\n            const url = selectedEpisode.prop('href');\n            $.getJSON(url, data => {\n                if (data.result.toLowerCase() === 'success') {\n                    // Clear and update the subtitles column with new informations\n                    const subtitles = data.subtitles.split(',');\n                    subtitlesTd.empty();\n                    $.each(subtitles, (index, language) => {\n                        if (language !== '') {\n                            if (index !== subtitles.length - 1) {\n                                // eslint-disable-line no-negated-condition\n                                changeImage(subtitlesTd, '', language, language, 11, true);\n                            } else {\n                                changeImage(subtitlesTd, 'images/subtitles/flags/' + language + '.png', language, language, 11, true);\n                            }\n                        }\n                    });\n                }\n                // Add back the CC icon as we are not searching anymore\n                changeImage(selectedEpisode, 'images/closed_captioning.png', 'Search subtitles', 'Search subtitles', 16, true);\n                enableAllSearches();\n            });\n            return false;\n        };\n\n        $('.epSubtitlesSearch').on('click', function (e) {\n            // This is for the page 'displayShow.mako'\n            e.preventDefault();\n            selectedEpisode = $(this);\n            subtitlesTd = selectedEpisode.parent().siblings('.col-subtitles');\n            // Ask user if he want to manual search subs or automatic search\n            $('#askmanualSubtitleSearchModal').modal('show');\n        });\n\n        $('.epSubtitlesSearchPP').on('click', function (e) {\n            // This is for the page 'manage_subtitleMissedPP.mako'\n            e.preventDefault();\n            selectedEpisode = $(this);\n            subtitlesTd = selectedEpisode.parent().siblings('.col-search');\n            searchSubtitles();\n        });\n\n        // @TODO: move this to a more specific selector\n        $(document).on('click', '#pickSub', function (e) {\n            e.preventDefault();\n            const subtitlePicked = $(this);\n            changeImage(subtitlePicked, loadingSpinner, 'loading', 'loading', 16, true);\n            let subtitleID = subtitlePicked.attr('subtitleID');\n            // Remove 'subtitleid-' so we know the actual ID\n            subtitleID = subtitleID.replace('subtitleid-', '');\n            let url = selectedEpisode.prop('href');\n            url = url.replace('searchEpisodeSubtitles', 'manual_search_subtitles');\n            // Append the ID param that 'manual_search_subtitles' expect when picking subtitles\n            url += '&picked_id=' + encodeURIComponent(subtitleID);\n            $.getJSON(url, data => {\n                // If user click to close the window before subtitle download finishes, show again the modal\n                if (subtitlesResultModal.is(':visible') === false) {\n                    subtitlesResultModal.modal('show');\n                }\n                if (data.result === 'success') {\n                    const language = data.subtitles;\n                    changeImage(subtitlePicked, 'images/yes16.png', 'subtitle saved', 'subtitle saved', 16, true);\n                    if ($('table#releasesPP').length > 0) {\n                        // Removes the release as we downloaded the subtitle\n                        // Only applied to manage_subtitleMissedPP.mako\n                        selectedEpisode.parent().parent().remove();\n                    } else {\n                        // Update the subtitles column with new informations\n                        if (subtitlesMulti === true) {\n                            // eslint-disable-line no-lonely-if\n                            const lang = language;\n                            let hasLang = false;\n                            subtitlesTd.children().children().each(function () {\n                                // Check if user already have this subtitle language\n                                if ($(this).attr('alt').indexOf(lang) !== -1) {\n                                    hasLang = true;\n                                }\n                            });\n                            // Only add language flag if user doesn't have this subtitle language\n                            if (hasLang === false) {\n                                changeImage(subtitlesTd, 'images/subtitles/flags/' + language + '.png', language, language, 11, false);\n                            }\n                        } else {\n                            changeImage(subtitlesTd, 'images/subtitles/flags/unknown.png', language, language, 11, false);\n                        }\n                    }\n                } else {\n                    changeImage(subtitlePicked, 'images/no16.png', 'subtitle not saved', 'subtitle not saved', 16, true);\n                }\n            });\n        });\n\n        $('#askmanualSubtitleSearchModal .btn').on('click', function () {\n            if ($(this).text().toLowerCase() === 'manual') {\n                // Call manual search\n                searchSubtitles();\n            } else {\n                // Call auto search\n                forcedSearch();\n            }\n        });\n    };\n\n    $.fn.ajaxEpMergeSubtitles = function () {\n        $('.epMergeSubtitles').on('click', function () {\n            const subtitlesMergeLink = $(this);\n            changeImage(subtitlesMergeLink, loadingSpinner, 'loading', 'loading', 16, true);\n            $.getJSON($(this).attr('href'), () => {\n                // Don't allow other merges\n                subtitlesMergeLink.remove();\n            });\n            return false;\n        });\n    };\n\n    $.ajaxEpRedownloadSubtitle = function () {\n        $('.epRedownloadSubtitle').on('click', function (e) {\n            e.preventDefault();\n            selectedEpisode = $(this);\n            $('#confirmSubtitleReDownloadModal').modal('show');\n        });\n\n        const redownloadSubtitles = () => {\n            disableAllSearches();\n            const url = selectedEpisode.prop('href');\n            const downloading = 'Re-downloading subtitle';\n            const failed = 'Re-downloaded subtitle failed';\n            const downloaded = 'Re-downloaded subtitle succeeded';\n            changeImage(selectedEpisode, loadingSpinner, downloading, downloading, 16, true);\n            $.getJSON(url, data => {\n                if (data.result.toLowerCase() === 'success' && data.new_subtitles.length > 0) {\n                    changeImage(selectedEpisode, 'images/save.png', downloaded, downloaded, 16, true);\n                } else {\n                    changeImage(selectedEpisode, 'images/no16.png', failed, failed, 16, true);\n                }\n            });\n            enableAllSearches();\n            return false;\n        };\n\n        $('#confirmSubtitleReDownloadModal .btn.btn-success').on('click', () => {\n            redownloadSubtitles();\n        });\n    };\n};\n\nmodule.exports = startAjaxEpisodeSubtitles;\n\n},{\"./core\":3}],2:[function(require,module,exports){\nconst baseUrl = $('body').attr('api-root');\nconst idToken = $('body').attr('api-key');\n\nconst api = axios.create({\n    baseURL: baseUrl,\n    timeout: 10000,\n    headers: {\n        'Accept': 'application/json',\n        'Content-Type': 'application/json',\n        'X-Api-Key': idToken\n    }\n});\n\nmodule.exports = api;\n\n},{}],3:[function(require,module,exports){\nconst api = require('./api');\n\n// eslint-disable-line max-lines\n// @TODO Move these into common.ini when possible,\n//       currently we can't do that as browser.js and a few others need it before this is loaded\nconst topImageHtml = '<img src=\"images/top.gif\" width=\"31\" height=\"11\" alt=\"Jump to top\" />'; // eslint-disable-line no-unused-vars\nconst apiRoot = $('body').attr('api-root');\nconst apiKey = $('body').attr('api-key');\n\nconst MEDUSA = {\n    common: {},\n    config: {},\n    home: {},\n    manage: {},\n    history: {},\n    errorlogs: {},\n    schedule: {},\n    addShows: {}\n};\n\nconst UTIL = {\n    exec(controller, action) {\n        const ns = MEDUSA;\n        action = action === undefined ? 'init' : action;\n\n        if (controller !== '' && ns[controller] && typeof ns[controller][action] === 'function') {\n            ns[controller][action]();\n        }\n    },\n    init() {\n        if (typeof startVue === 'function') {\n            // eslint-disable-line no-undef\n            startVue(); // eslint-disable-line no-undef\n        } else {\n            $('[v-cloak]').removeAttr('v-cloak');\n        }\n\n        const body = document.body;\n        $('[asset]').each(function () {\n            const asset = $(this).attr('asset');\n            const series = $(this).attr('series');\n            const path = apiRoot + 'series/' + series + '/asset/' + asset + '?api_key=' + apiKey;\n            if (this.tagName.toLowerCase() === 'img') {\n                if ($(this).attr('lazy') === 'on') {\n                    $(this).attr('data-original', path);\n                } else {\n                    $(this).attr('src', path);\n                }\n            }\n            if (this.tagName.toLowerCase() === 'a') {\n                $(this).attr('href', path);\n            }\n        });\n        const controller = body.getAttribute('data-controller');\n        const action = body.getAttribute('data-action');\n\n        UTIL.exec('common');\n        UTIL.exec(controller);\n        UTIL.exec(controller, action);\n    }\n};\n\n$.extend({\n    isMeta(pyVar, result) {\n        const reg = new RegExp(result.length > 1 ? result.join('|') : result);\n\n        if (typeof pyVar === 'object' && Object.keys(pyVar).length === 1) {\n            return reg.test(MEDUSA.config[Object.keys(pyVar)[0]][pyVar[Object.keys(pyVar)[0]]]);\n        }\n        if (pyVar.match('medusa')) {\n            pyVar.split('.')[1].toLowerCase().replace(/(_\\w)/g, m => m[1].toUpperCase());\n        }\n        return reg.test(MEDUSA.config[pyVar]);\n    }\n});\n\n$.fn.extend({\n    addRemoveWarningClass(_) {\n        if (_) {\n            return $(this).removeClass('warning');\n        }\n        return $(this).addClass('warning');\n    }\n});\n\nconst triggerConfigLoaded = function () {\n    // Create the event.\n    const event = new CustomEvent('build', { detail: 'medusa config loaded' });\n    event.initEvent('build', true, true);\n    // Trigger the event.\n    document.dispatchEvent(event);\n};\n\nif (!document.location.pathname.endsWith('/login/')) {\n    api.get('config/main').then(response => {\n        log.setDefaultLevel('trace');\n        $.extend(MEDUSA.config, response.data);\n        MEDUSA.config.themeSpinner = MEDUSA.config.themeName === 'dark' ? '-dark' : '';\n        MEDUSA.config.loading = '<img src=\"images/loading16' + MEDUSA.config.themeSpinner + '.gif\" height=\"16\" width=\"16\" />';\n\n        if (navigator.userAgent.indexOf('PhantomJS') === -1) {\n            $(document).ready(UTIL.init);\n        }\n        triggerConfigLoaded();\n    }).catch(err => {\n        log.error(err);\n        alert('Unable to connect to Medusa!'); // eslint-disable-line no-alert\n    });\n}\n\nmodule.exports = MEDUSA;\n\n},{\"./api\":2}],4:[function(require,module,exports){\nconst MEDUSA = require('../core');\nconst startAjaxEpisodeSubtitles = require('../ajax-episode-subtitles');\n\nMEDUSA.home.displayShow = function () {\n    // eslint-disable-line max-lines\n    // Adjust the summary background position and size on page load and resize\n    const moveSummaryBackground = () => {\n        const height = $('#summary').height() + 10;\n        const top = $('#summary').offset().top + 5;\n        $('#summaryBackground').height(height);\n        $('#summaryBackground').offset({ top, left: 0 });\n        $('#summaryBackground').show();\n    };\n\n    const movecheckboxControlsBackground = () => {\n        const height = $('#checkboxControls').height() + 10;\n        const top = $('#checkboxControls').offset().top - 3;\n        $('#checkboxControlsBackground').height(height);\n        $('#checkboxControlsBackground').offset({ top, left: 0 });\n        $('#checkboxControlsBackground').show();\n    };\n\n    $('.imdbPlot').on('click', function () {\n        $(this).prev('span').toggle();\n        if ($(this).html() === '..show less') {\n            $(this).html('..show more');\n        } else {\n            $(this).html('..show less');\n        }\n        moveSummaryBackground();\n        movecheckboxControlsBackground();\n    });\n\n    $(window).on('resize', () => {\n        moveSummaryBackground();\n        movecheckboxControlsBackground();\n    });\n\n    $(() => {\n        moveSummaryBackground();\n        movecheckboxControlsBackground();\n    });\n\n    $.ajaxEpSearch({\n        colorRow: true\n    });\n\n    startAjaxEpisodeSubtitles();\n    $.ajaxEpSubtitlesSearch();\n    $.ajaxEpRedownloadSubtitle();\n\n    $('#seasonJump').on('change', function () {\n        const id = $('#seasonJump option:selected').val();\n        if (id && id !== 'jump') {\n            const season = $('#seasonJump option:selected').data('season');\n            $('html,body').animate({ scrollTop: $('[name =\"' + id.substring(1) + '\"]').offset().top - 50 }, 'slow');\n            $('#collapseSeason-' + season).collapse('show');\n            location.hash = id;\n        }\n        $(this).val('jump');\n    });\n\n    $('#prevShow').on('click', () => {\n        $('#select-show option:selected').prev('option').prop('selected', true);\n        $('#select-show').change();\n    });\n\n    $('#nextShow').on('click', () => {\n        $('#select-show option:selected').next('option').prop('selected', true);\n        $('#select-show').change();\n    });\n\n    $('#changeStatus').on('click', () => {\n        const epArr = [];\n\n        $('.epCheck').each(function () {\n            if (this.checked === true) {\n                epArr.push($(this).attr('id'));\n            }\n        });\n\n        if (epArr.length === 0) {\n            return false;\n        }\n\n        window.location.href = $('base').attr('href') + 'home/setStatus?show=' + $('#series-id').attr('value') + '&eps=' + epArr.join('|') + '&status=' + $('#statusSelect').val();\n    });\n\n    $('.seasonCheck').on('click', function () {\n        const seasCheck = this;\n        const seasNo = $(seasCheck).attr('id');\n\n        $('#collapseSeason-' + seasNo).collapse('show');\n        $('.epCheck:visible').each(function () {\n            const epParts = $(this).attr('id').split('x');\n            if (epParts[0] === seasNo) {\n                this.checked = seasCheck.checked;\n            }\n        });\n    });\n\n    let lastCheck = null;\n    $('.epCheck').on('click', function (event) {\n        if (!lastCheck || !event.shiftKey) {\n            lastCheck = this;\n            return;\n        }\n\n        const check = this;\n        let found = 0;\n\n        $('.epCheck').each(function () {\n            if (found === 1) {\n                this.checked = lastCheck.checked;\n            }\n\n            if (found === 1) {\n                return false;\n            }\n\n            if (this === check || this === lastCheck) {\n                found++;\n            }\n        });\n    });\n\n    // Selects all visible episode checkboxes.\n    $('.seriesCheck').on('click', () => {\n        $('.epCheck:visible').each(function () {\n            this.checked = true;\n        });\n        $('.seasonCheck:visible').each(function () {\n            this.checked = true;\n        });\n    });\n\n    // Clears all visible episode checkboxes and the season selectors\n    $('.clearAll').on('click', () => {\n        $('.epCheck:visible').each(function () {\n            this.checked = false;\n        });\n        $('.seasonCheck:visible').each(function () {\n            this.checked = false;\n        });\n    });\n\n    // Handle the show selection dropbox\n    $('#select-show').on('change', function () {\n        const val = $(this).val();\n        if (val === 0) {\n            return;\n        }\n        window.location.href = $('base').attr('href') + 'home/displayShow?show=' + val;\n    });\n\n    // Show/Hide different types of rows when the checkboxes are changed\n    $('#checkboxControls input').on('change', function () {\n        const whichClass = $(this).attr('id');\n        $(this).showHideRows(whichClass);\n    });\n\n    // Initially show/hide all the rows according to the checkboxes\n    $('#checkboxControls input').each(function () {\n        const status = $(this).prop('checked');\n        $('tr.' + $(this).attr('id')).each(function () {\n            if (status) {\n                $(this).show();\n            } else {\n                $(this).hide();\n            }\n        });\n    });\n\n    $.fn.showHideRows = function (whichClass) {\n        const status = $('#checkboxControls > input, #' + whichClass).prop('checked');\n        $('tr.' + whichClass).each(function () {\n            if (status) {\n                $(this).show();\n            } else {\n                $(this).hide();\n            }\n        });\n\n        // Hide season headers with no episodes under them\n        $('tr.seasonheader').each(function () {\n            const seasonNo = $(this).attr('id');\n            let numRows = 0;\n            $('tr.' + seasonNo + ' :visible').each(() => {\n                numRows++;\n            });\n            if (numRows === 0) {\n                $(this).hide();\n                $('#' + seasonNo + '-cols').hide();\n            } else {\n                $(this).show();\n                $('#' + seasonNo + '-cols').show();\n            }\n        });\n    };\n\n    const setEpisodeSceneNumbering = (forSeason, forEpisode, sceneSeason, sceneEpisode) => {\n        const showId = $('#series-id').val();\n        const indexer = $('#indexer').val();\n\n        if (sceneSeason === '') {\n            sceneSeason = null;\n        }\n        if (sceneEpisode === '') {\n            sceneEpisode = null;\n        }\n\n        $.getJSON('home/setSceneNumbering', {\n            show: showId,\n            indexer,\n            forSeason,\n            forEpisode,\n            sceneSeason,\n            sceneEpisode\n        }, data => {\n            // Set the values we get back\n            if (data.sceneSeason === null || data.sceneEpisode === null) {\n                $('#sceneSeasonXEpisode_' + showId + '_' + forSeason + '_' + forEpisode).val('');\n            } else {\n                $('#sceneSeasonXEpisode_' + showId + '_' + forSeason + '_' + forEpisode).val(data.sceneSeason + 'x' + data.sceneEpisode);\n            }\n            if (!data.success) {\n                if (data.errorMessage) {\n                    alert(data.errorMessage); // eslint-disable-line no-alert\n                } else {\n                    alert('Update failed.'); // eslint-disable-line no-alert\n                }\n            }\n        });\n    };\n\n    const setAbsoluteSceneNumbering = (forAbsolute, sceneAbsolute) => {\n        const showId = $('#series-id').val();\n        const indexer = $('#indexer').val();\n\n        if (sceneAbsolute === '') {\n            sceneAbsolute = null;\n        }\n\n        $.getJSON('home/setSceneNumbering', {\n            show: showId,\n            indexer,\n            forAbsolute,\n            sceneAbsolute\n        }, data => {\n            // Set the values we get back\n            if (data.sceneAbsolute === null) {\n                $('#sceneAbsolute_' + showId + '_' + forAbsolute).val('');\n            } else {\n                $('#sceneAbsolute_' + showId + '_' + forAbsolute).val(data.sceneAbsolute);\n            }\n\n            if (!data.success) {\n                if (data.errorMessage) {\n                    alert(data.errorMessage); // eslint-disable-line no-alert\n                } else {\n                    alert('Update failed.'); // eslint-disable-line no-alert\n                }\n            }\n        });\n    };\n\n    const setInputValidInvalid = (valid, el) => {\n        if (valid) {\n            $(el).css({\n                'background-color': '#90EE90', // Green\n                color: '#FFF',\n                'font-weight': 'bold'\n            });\n            return true;\n        }\n        $(el).css({\n            'background-color': '#FF0000', // Red\n            color: '#FFF!important',\n            'font-weight': 'bold'\n        });\n        return false;\n    };\n\n    $('.sceneSeasonXEpisode').on('change', function () {\n        // Strip non-numeric characters\n        const value = $(this).val();\n        $(this).val(value.replace(/[^0-9xX]*/g, ''));\n        const forSeason = $(this).attr('data-for-season');\n        const forEpisode = $(this).attr('data-for-episode');\n\n        // If empty reset the field\n        if (value === '') {\n            setEpisodeSceneNumbering(forSeason, forEpisode, null, null);\n            return;\n        }\n\n        const m = $(this).val().match(/^(\\d+)x(\\d+)$/i);\n        const onlyEpisode = $(this).val().match(/^(\\d+)$/i);\n        let sceneSeason = null;\n        let sceneEpisode = null;\n        let isValid = false;\n        if (m) {\n            sceneSeason = m[1];\n            sceneEpisode = m[2];\n            isValid = setInputValidInvalid(true, $(this));\n        } else if (onlyEpisode) {\n            // For example when '5' is filled in instead of '1x5', asume it's the first season\n            sceneSeason = forSeason;\n            sceneEpisode = onlyEpisode[1];\n            isValid = setInputValidInvalid(true, $(this));\n        } else {\n            isValid = setInputValidInvalid(false, $(this));\n        }\n\n        if (isValid) {\n            setEpisodeSceneNumbering(forSeason, forEpisode, sceneSeason, sceneEpisode);\n        }\n    });\n\n    $('.sceneAbsolute').on('change', function () {\n        // Strip non-numeric characters\n        $(this).val($(this).val().replace(/[^0-9xX]*/g, ''));\n        const forAbsolute = $(this).attr('data-for-absolute');\n\n        const m = $(this).val().match(/^(\\d{1,3})$/i);\n        let sceneAbsolute = null;\n        if (m) {\n            sceneAbsolute = m[1];\n        }\n        setAbsoluteSceneNumbering(forAbsolute, sceneAbsolute);\n    });\n\n    $.fn.generateStars = function () {\n        return this.each((i, e) => {\n            $(e).html($('<span/>').width($(e).text() * 12));\n        });\n    };\n\n    $('.imdbstars').generateStars();\n\n    $('#showTable, #animeTable').tablesorter({\n        widgets: ['saveSort', 'stickyHeaders', 'columnSelector'],\n        widgetOptions: {\n            columnSelector_saveColumns: true, // eslint-disable-line camelcase\n            columnSelector_layout: '<label><input type=\"checkbox\">{name}</label>', // eslint-disable-line camelcase\n            columnSelector_mediaquery: false, // eslint-disable-line camelcase\n            columnSelector_cssChecked: 'checked' // eslint-disable-line camelcase\n        }\n    });\n\n    $('#popover').popover({\n        placement: 'bottom',\n        html: true,\n        content: '<div id=\"popover-target\"></div>'\n    }).on('shown.bs.popover', () => {\n        $.tablesorter.columnSelector.attachTo($('#showTable, #animeTable'), '#popover-target');\n    });\n\n    // Moved and rewritten this from displayShow. This changes the button when clicked for collapsing/expanding the\n    // Season to Show Episodes or Hide Episodes.\n    $(() => {\n        $('.collapse.toggle').on('hide.bs.collapse', function () {\n            const reg = /collapseSeason-([0-9]+)/g;\n            const result = reg.exec(this.id);\n            $('#showseason-' + result[1]).text('Show Episodes');\n            $('#season-' + result[1] + '-cols').addClass('shadow');\n        });\n        $('.collapse.toggle').on('show.bs.collapse', function () {\n            const reg = /collapseSeason-([0-9]+)/g;\n            const result = reg.exec(this.id);\n            $('#showseason-' + result[1]).text('Hide Episodes');\n            $('#season-' + result[1] + '-cols').removeClass('shadow');\n        });\n    });\n\n    // Set the season exception based on using the get_xem_numbering_for_show() for animes if available in data.xemNumbering,\n    // or else try to map using just the data.season_exceptions.\n    function setSeasonSceneException(data) {\n        $.each(data.seasonExceptions, (season, nameExceptions) => {\n            let foundInXem = false;\n            // Check if it is a season name exception, we don't handle the show name exceptions here\n            if (season >= 0) {\n                // Loop through the xem mapping, and check if there is a xem_season, that needs to show the season name exception\n                $.each(data.xemNumbering, (indexerSeason, xemSeason) => {\n                    if (xemSeason === parseInt(season, 10)) {\n                        foundInXem = true;\n                        $('<img>', {\n                            id: 'xem-exception-season-' + xemSeason,\n                            alt: '[xem]',\n                            height: '16',\n                            width: '16',\n                            src: 'images/xem.png',\n                            title: nameExceptions.join(', ')\n                        }).appendTo('[data-season=' + indexerSeason + ']');\n                    }\n                });\n\n                // This is not a xem season exception, let's set the exceptions as a medusa exception\n                if (!foundInXem) {\n                    $('<img>', {\n                        id: 'xem-exception-season-' + season,\n                        alt: '[medusa]',\n                        height: '16',\n                        width: '16',\n                        src: 'images/ico/favicon-16.png',\n                        title: nameExceptions.join(', ')\n                    }).appendTo('[data-season=' + season + ']');\n                }\n            }\n        });\n    }\n\n    // @TODO: OMG: This is just a basic json, in future it should be based on the CRUD route.\n    // Get the season exceptions and the xem season mappings.\n    $.getJSON('home/getSeasonSceneExceptions', {\n        indexer: $('input#indexer').val(),\n        indexer_id: $('input#series-id').val() // eslint-disable-line camelcase\n    }, data => {\n        setSeasonSceneException(data);\n    });\n\n    //\n    // href=\"home/toggleDisplayShowSpecials/?show=${show.indexerid}\"\n    $('.display-specials a').on('click', function () {\n        api.patch('config/main', {\n            layout: {\n                show: {\n                    specials: $(this).text() !== 'Hide'\n                }\n            }\n        }).then(response => {\n            log.info(response.data);\n            window.location.reload();\n        }).catch(err => {\n            log.error(err.data);\n        });\n    });\n};\n\n},{\"../ajax-episode-subtitles\":1,\"../core\":3}]},{},[4]);\n"],"file":"display-show.js"}